<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>XHCI</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>æœ¬æ–‡å‚è€ƒäº† <a href="https://wiki.osdev.org/XHCI">XHCI on OS Dev</a> ä»¥åŠ ã€ŠUSB: The Universal Series Busã€‹ã€‚ä»£ç å­˜å‚¨äº <code>github.com/juruohejiarui/VCPP-2.git</code> ä¸­çš„ <code>VOS/kernel/hardware/USB</code> .</p>
<p>éœ€è¦å…ˆç®€å•äº†è§£ PCIe çš„æ•°æ®ç»“æ„å’Œæšä¸¾ã€æ£€æµ‹ UEFI æä¾›çš„ PCIe ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<h1 id="æ•°æ®ç»“æ„å’Œæ³¨é‡Š">æ•°æ®ç»“æ„å’Œæ³¨é‡Š</h1>
<p>XHCI æ§åˆ¶å™¨æœ‰å¤§é‡çš„å¯„å­˜å™¨ç»„å’Œæè¿°ï¼Œéœ€è¦ä¸€å®šçš„è€å¿ƒã€‚ä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦å…¨éƒ¨äº†è§£ï¼Œåªéœ€è¦çŸ¥é“ä¸€äº›åŸºæœ¬çš„ï¼Œå¯ä»¥ç”¨äºè®¾å¤‡æšä¸¾ï¼Œæ£€æµ‹å’Œé€šä¿¡çš„å¯„å­˜å™¨å°±å¯ä»¥äº†ã€‚ä½†æ˜¯ä¸ºäº†æŸ¥é˜…æ–¹ä¾¿ï¼Œè¿™é‡Œæˆ‘è¿˜æ˜¯å‡ ä¹å®Œå…¨æ‘˜æŠ„äº†ã€ŠUSB: The Universal Series Busã€‹å¯¹äºæ¯ä¸€ä¸ªæè¿°ç¬¦çš„è§£é‡Šã€‚å½“æˆ‘ä»¬éœ€è¦æŸäº›åŠŸèƒ½çš„æ—¶å€™å†å›æ¥æŸ¥é˜…è¡¨æ ¼å³å¯ã€‚å¦‚æœå­¦ä¹ è¿‡ç¨‹ä¸­å‘ç°ä¸€äº›ä¸æ‡‚å¾—åè¯ï¼Œå¯ä»¥å…ˆæŠŠå®ƒè®°ä¸‹æ¥ï¼Œä¹‹åé‡åˆ°äº†å®šä¹‰æˆ–è§£é‡Šçš„æ—¶å€™å†è¿”å›æ¥çœ‹ï¼Œå¦‚æœä¹‹åéƒ½æ²¡æœ‰å‡ºç°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºå®ƒå¹¶ä¸é‡è¦ã€‚</p>
<h2 id="pcie">PCIe</h2>
<p>ä» UEFI æä¾›çš„ <code>MCFG</code> è¡¨ä¸­ï¼Œå¯ä»¥è¯»å‡ºä¸€ä¸ª PCIe æ•°æ®è¡¨å¤´çš„ç»“æ„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>PCIeConfig</code>ï¼Œå¯¹äº XHCI è®¾å¤‡ï¼Œå…¶ç»“æ„ä¸€èˆ¬å¦‚ä¸‹ï¼š</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Offset</th>
<th style="text-align: center;">Size(Byte)</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0x0</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
<td style="text-align: center;">Vendor ID</td>
<td style="text-align: left;">åˆ¶é€ å•† ID</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x2</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
<td style="text-align: center;">Device ID</td>
<td style="text-align: left;">åˆ¶é€ å•†ç”³è¯·çš„è®¾å¤‡ç‰¹å®šçš„ ID</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x4</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
<td style="text-align: center;">Command</td>
<td style="text-align: left;">ç”¨äºæ“ä½œè¯¥PCIeè®¾å¤‡çš„å¯„å­˜å™¨</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x6</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
<td style="text-align: center;">Status</td>
<td style="text-align: left;">è¯¥è®¾å¤‡çš„çŠ¶æ€</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x8</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Revision ID</td>
<td style="text-align: left;">æˆ‘ä¹Ÿä¸æ‡‚ï¼Œåº”è¯¥ä¸å¤ªé‡è¦ï¼Œå¯ä»¥å¿½ç•¥</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x9</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Prog IF</td>
<td style="text-align: left;">Program Interface Byte, åªè¯»ï¼Œç”¨äºå¯„å­˜å™¨çº§åˆ«ä¸‹æŒ‡å®šè¯¥è®¾å¤‡çš„ç±»åˆ«</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0xa</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Subclass</td>
<td style="text-align: left;">å­ç±» ID</td>
</tr>
<tr class="even">
<td style="text-align: center;">0xb</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Class Id</td>
<td style="text-align: left;">ç±» ID</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0xc</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Cache Line Size</td>
<td style="text-align: left;">æˆ‘ä¹Ÿä¸æ‡‚ï¼Œåº”è¯¥ä¸å¤ªé‡è¦ï¼Œå¯ä»¥å¿½ç•¥</td>
</tr>
<tr class="even">
<td style="text-align: center;">0xd</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Latency Timer</td>
<td style="text-align: left;">ç”¨äºPCIï¼ŒPCIeä¸æ”¯æŒï¼Œå›ºå®šä¸º <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;">0xe</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Header Type</td>
<td style="text-align: left;">æŒ‡ç¤ºè¯¥è¡¨å¤´å‰©ä½™å†…å®¹çš„ç»“æ„</td>
</tr>
<tr class="even">
<td style="text-align: center;">0xf</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">BIST</td>
<td style="text-align: left;">Built-in self test, è®¾å¤‡çš„å†…å»ºè‡ªæ£€çŠ¶æ€å’Œæ§åˆ¶å¯„å­˜å™¨</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x10</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Bar0</td>
<td style="text-align: left;">Base Address 0</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x14</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Bar1</td>
<td style="text-align: left;">Base Address <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x18</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Bar2</td>
<td style="text-align: left;">Base Address <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;">0x1c</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Bar3</td>
<td style="text-align: left;">Base Address 3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x20</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Bar4</td>
<td style="text-align: left;">Base Address <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;">0x24</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Bar5</td>
<td style="text-align: left;">Base Address 5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x28</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Cardbus CIS Pointer</td>
<td style="text-align: left;">æŒ‡å‘ Cardbus ç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥å€¼è¢« PCI å’Œ Cardbus å…±äº«ï¼ˆæœºç¿»ï¼‰</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x2c</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
<td style="text-align: center;">Subsystem Vendor ID</td>
<td style="text-align: left;">å­ç³»ç»Ÿçš„Vendor ID, ä¸é‡è¦</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x2e</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></td>
<td style="text-align: center;">subsystem ID</td>
<td style="text-align: left;">å­ç³»ç»ŸIDï¼Œä¸é‡è¦</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x30</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math></td>
<td style="text-align: center;">Expansion ROM base address</td>
<td style="text-align: left;">ä¸æ‡‚ï¼Œåº”è¯¥ä¸å¤ªé‡è¦</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x34</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Capabilities Pointer</td>
<td style="text-align: left;">ä½¿èƒ½å¯„å­˜å™¨çš„åç§»é‡</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x35</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>7</mn><annotation encoding="application/x-tex">7</annotation></semantics></math></td>
<td style="text-align: center;">Reserved</td>
<td style="text-align: left;">ä¿ç•™ä½ç½®ï¼Œä¸èƒ½è¯»å†™</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x3c</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Interrupt Line</td>
<td style="text-align: left;">ç”¨äºæŒ‡å®šè¯¥è®¾å¤‡è¿æ¥åˆ° PIC (ä¸æ˜¯I/O APIC) çš„ (IRQ0,IRQ1â€¦IRQ15) å“ªä¸ªï¼ˆäº›ï¼‰å¼•è„š, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="monospace">ğŸ¶ğš¡ğšğš</mtext><annotation encoding="application/x-tex">\texttt{0xff}</annotation></semantics></math> åˆ™è¡¨ç¤ºæ— è¿æ¥</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x3d</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Interrupt PIN</td>
<td style="text-align: left;">ç”¨äºæŒ‡å®šè¯¥è®¾å¤‡ä½¿ç”¨å“ªä¸ªä¸­æ–­å¼•è„šï¼Œ<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¶</mtext><mo>â†’</mo><mtext mathvariant="normal">does not use</mtext><mo>,</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ·</mtext><mo>â†’</mo><mtext mathvariant="monospace">ğ™¸ğ™½ğšƒğ™°</mtext><mo>,</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¸</mtext><mo>â†’</mo><mtext mathvariant="monospace">ğ™¸ğ™½ğšƒğ™±</mtext></mrow><annotation encoding="application/x-tex">\texttt{0x0}\rightarrow \text{does not use},\texttt{0x1}\rightarrow \texttt{INTA}, \texttt{0x2}\rightarrow \texttt{INTB}</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¹</mtext><mo>â†’</mo><mtext mathvariant="monospace">ğ™¸ğ™½ğšƒğ™²</mtext></mrow><annotation encoding="application/x-tex">\texttt{0x3}\rightarrow \texttt{INTC}</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸº</mtext><mo>â†’</mo><mtext mathvariant="monospace">ğ™¸ğ™½ğšƒğ™³</mtext></mrow><annotation encoding="application/x-tex">\texttt{0x4}\rightarrow \texttt{INTD}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x3e</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Min Grant</td>
<td style="text-align: left;">ç”¨äº PCI ï¼ŒPCIe ä¸‹ä¸å¯ç”¨ï¼Œå›ºå®šä¸º <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;">0x3f</td>
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math></td>
<td style="text-align: center;">Max Latency</td>
<td style="text-align: left;">ç”¨äº PCI ï¼ŒPCIe ä¸‹ä¸å¯ç”¨ï¼Œå›ºå®šä¸º <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">Class Id, subClass, Prog IF</mtext><annotation encoding="application/x-tex">\text{Class Id, subClass, Prog IF}</annotation></semantics></math> ä¸‰è€…å…±åŒç¡®è®¤ä¸€ä¸ªè®¾å¤‡çš„ç±»åˆ«ï¼Œç½‘ä¸Šæœ‰å¯¹ç…§è¡¨ï¼Œè¿™é‡Œå°±ä¸ç²˜å‡ºæ¥äº†ã€‚å¯¹äº XHCI è®¾å¤‡ï¼Œ<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Class Id</mtext><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğ™²</mtext><mo>,</mo><mtext mathvariant="normal">Subclass</mtext><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¹</mtext><mo>,</mo><mtext mathvariant="normal">Prog IF</mtext><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¹ğŸ¶</mtext></mrow><annotation encoding="application/x-tex">\text{Class Id}=\texttt{0xC}, \text{Subclass}=\texttt{0x3}, \text{Prog IF}=\texttt{0x30}</annotation></semantics></math></p>
<h3 id="header-type-ç»“æ„">Header Type ç»“æ„</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Bit 7</th>
<th style="text-align: center;">Bit 0 : 6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">è¯¥è®¾å¤‡æ˜¯(1)/å¦(0)ä¸ºå¤šåŠŸèƒ½(multi-function)è®¾å¤‡</td>
<td style="text-align: center;">è¡¨å¤´å‰©ä½™ç»“æ„çš„ç±»å‹</td>
</tr>
</tbody>
</table>
<p>å¯¹äº Bit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>:</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">0:6</annotation></semantics></math> ï¼Œåªæœ‰ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¶</mtext><mo>,</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ·</mtext><mo>,</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¸</mtext></mrow><annotation encoding="application/x-tex">\texttt{0x0},\texttt{0x1},\texttt{0x2}</annotation></semantics></math> ä¸‰ç§å–å€¼ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥ PCIe è®¾å¤‡æ˜¯ä¸€ä¸ª General Device, PCI-to-PCI bridge, PCI-to-Cardbus bridge ï¼Œå¯¹äº XHCI è®¾å¤‡ï¼Œå…¶ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">Header Type</mtext><annotation encoding="application/x-tex">\text{Header Type}</annotation></semantics></math> å€¼ä¸€å®šä¸º <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¶</mtext><annotation encoding="application/x-tex">\texttt{0x0}</annotation></semantics></math> æˆ– <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¾ğŸ¶</mtext><annotation encoding="application/x-tex">\texttt{0x80}</annotation></semantics></math> ã€‚è€Œä¸Šè¿°å±•ç¤ºçš„PCIeè¡¨ç»“æ„å°±æ˜¯ Bit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>:</mo><mn>6</mn><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¶</mtext></mrow><annotation encoding="application/x-tex">0:6=\texttt{0x0}</annotation></semantics></math> æ—¶çš„ç»“æ„ï¼Œå¯¹äºå…¶ä»–æƒ…å†µï¼Œå¯ä»¥å‚è€ƒ <a href="https://wiki.osdev.org/PCI">PCI on OS Dev</a> ã€‚</p>
<h2 id="xhci">XHCI</h2>
<h3 id="capability-registers">Capability Registers</h3>
<p>å¯ä»¥ç¿»è¯‘ä¸ºä½¿èƒ½å¯„å­˜å™¨ç»„ï¼Œè¿™äº›å¯„å­˜å™¨å‡ä¸ºåªè¯»(RO)å¯„å­˜å™¨ã€‚å­˜å‚¨äº†å¤§é‡çš„æ§åˆ¶å™¨æ”¯æŒä¿¡æ¯ã€‚å…¶åŸºåœ°å€å¯ä»¥ä½¿ç”¨ <code>PCIeConfig</code> çš„ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">bar0</mtext><mo>,</mo><mtext mathvariant="normal">bar1</mtext></mrow><annotation encoding="application/x-tex">\text{bar0}, \text{bar1}</annotation></semantics></math> ç»„åˆè·å–ï¼Œè®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">// å°†ä¸¤ä¸ªåœ°å€çš„å€¼æ‹¼æ¥èµ·æ¥ï¼Œç„¶åå¯¹ 4K ä¸‹å–æ•´å¯¹é½</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>addr=(bar0 | (bar1 &lt;&lt; <span class="dv">32</span>)) &amp; (~((<span class="dv">1</span> &lt;&lt; <span class="dv">12</span>) - <span class="dv">1</span>))</span></code></pre></div>
<p>è¿™ä¸ª <code>addr</code> å¯ä»¥è®°å½•ä¸º <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">baseAddr</mtext><annotation encoding="application/x-tex">\text{baseAddr}</annotation></semantics></math> ï¼Œç¨åä¾ç„¶ä¼šç”¨åˆ°ã€‚æ¥ä¸‹æ¥ç›´æ¥åˆ—å‡ºè¿™äº›å¯„å­˜å™¨çš„ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Offset</th>
<th style="text-align: center;">Size(Byte)</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0x0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">CapLen</td>
<td style="text-align: left;">ä½¿èƒ½å¯„å­˜å™¨ç»„çš„å¤§å°</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RSVD</td>
<td style="text-align: left;">ä¿ç•™</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">hciVersion</td>
<td style="text-align: left;">æ¥å£çš„ç‰ˆæœ¬æ•°å­—ï¼Œä¸éœ€è¦å…³æ³¨</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x4</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">hcsParams1</td>
<td style="text-align: left;">ç»“æ„åŒ–çš„å‚æ•°ç»„ #1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x8</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">hcsParams2</td>
<td style="text-align: left;">ç»“æ„åŒ–çš„å‚æ•°ç»„ #2</td>
</tr>
<tr class="even">
<td style="text-align: center;">0xc</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">hcsParams3</td>
<td style="text-align: left;">ç»“æ„åŒ–çš„å‚æ•°ç»„ #3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x10</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">hccParams1</td>
<td style="text-align: left;">ä½¿èƒ½å‚æ•°ç»„ #1</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x14</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">dbOff</td>
<td style="text-align: left;">Doorbell å¯„å­˜å™¨ç»„çš„åç§»ï¼Œå¯¹ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math> å¯¹é½ï¼ˆç›¸å¯¹äº <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">baseAddr</mtext><annotation encoding="application/x-tex">\text{baseAddr}</annotation></semantics></math>ï¼‰</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x18</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">rtsOff</td>
<td style="text-align: left;">è¿è¡Œæ—¶å¯„å­˜å™¨ç©ºé—´çš„åç§»ï¼Œå¯¹ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>64</mn><annotation encoding="application/x-tex">64</annotation></semantics></math> å¯¹é½ï¼Œç›¸å¯¹äº ï¼ˆç›¸å¯¹äº <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">baseAddr</mtext><annotation encoding="application/x-tex">\text{baseAddr}</annotation></semantics></math>ï¼‰</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x1c</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">hccParams2</td>
<td style="text-align: left;">ä½¿èƒ½å‚æ•°ç»„ #2</td>
</tr>
</tbody>
</table>
<p>ä¸Šé¢çš„è¡¨ä¸­æåˆ°äº†äº”ä¸ªå‚æ•°ç»„ï¼Œå®é™…ä¸Šå°±æ˜¯å°†ä¸€äº›å€¼æ¯”è¾ƒå°çš„ä¿¡æ¯æ‹¼æ¥èµ·æ¥ï¼ŒèŠ‚çœç©ºé—´ï¼Œæ¥ä¸‹æ¥ç»™å‡ºæ¯ä¸ªå‚æ•°ç»„çš„å…·ä½“å†…å®¹ã€‚</p>
<h4 id="hcsparams-1-ç»“æ„åŒ–çš„å‚æ•°ç»„-1">hcsParams 1, ç»“æ„åŒ–çš„å‚æ•°ç»„ #1</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Bit</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0:7</td>
<td style="text-align: center;">MaxSlots</td>
<td style="text-align: left;">æœ€å¤§æ’æ§½çš„ç¼–å·</td>
</tr>
<tr class="even">
<td style="text-align: center;">8:18</td>
<td style="text-align: center;">MaxIntrs</td>
<td style="text-align: left;">æœ€å¤§çš„ä¸­æ–­ç¼–å·</td>
</tr>
<tr class="odd">
<td style="text-align: center;">19:23</td>
<td style="text-align: center;">Reserved</td>
<td style="text-align: left;">ä¿ç•™</td>
</tr>
<tr class="even">
<td style="text-align: center;">24:31</td>
<td style="text-align: center;">MaxPorts</td>
<td style="text-align: left;">æœ€å¤§ç«¯å£çš„ç¼–å·</td>
</tr>
</tbody>
</table>
<p>è¿™ä¸‰ä¸ªæœ€å¤§å€¼å¯ä»¥ç”¨äºæšä¸¾ç«¯å£å’Œä¸­æ–­ï¼Œä½†æ³¨æ„ï¼Œå¯ç”¨çš„ç«¯å£å’Œé€‰æ‹©ä½¿ç”¨çš„ä¸­æ–­å¯èƒ½å¹¶ä¸è¿ç»­ã€‚</p>
<h4 id="hcsparams-2-ç»“æ„åŒ–çš„å‚æ•°ç»„-2">hcsParams 2, ç»“æ„åŒ–çš„å‚æ•°ç»„ #2</h4>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Bit</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0:3</td>
<td style="text-align: center;">Isochronous Scheduling Threshold (IST)</td>
<td style="text-align: left;">å‘Šè¯‰è½¯ä»¶å®ƒå¯ä»¥åœ¨å¤šè¿œçš„å¸§ä¸­ä¿®æ”¹ TRBï¼ˆä¼ è¾“è¯·æ±‚å—ï¼‰å¹¶ä¸”ä»èƒ½æ­£ç¡®æ‰§è¡Œ</td>
</tr>
<tr class="even">
<td style="text-align: center;">4:7</td>
<td style="text-align: center;">Event Ring Segment Table Max (ERST Max)</td>
<td style="text-align: left;">Event Ring Segment Table Base Size registers (ç¨åä¼šæœ‰è§£é‡Š) å¯ä»¥æ”¯æŒçš„æœ€å¤§å€¼</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8:20</td>
<td style="text-align: center;">Reserved</td>
<td style="text-align: left;">ä¿ç•™</td>
</tr>
<tr class="even">
<td style="text-align: center;">21:25</td>
<td style="text-align: center;">Max Scractchpad Buffer(High 5 bits)</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">26</td>
<td style="text-align: center;">Scratchpad Restore(SPR)</td>
<td style="text-align: left;">è¡¨ç¤ºæ˜¯å¦æ”¯æŒæš‚å­˜å™¨ä¿å­˜/æ¢å¤ç¼“å†²åŒº</td>
</tr>
<tr class="even">
<td style="text-align: center;">27:31</td>
<td style="text-align: center;">Max Scractchpad Buffer(Low 5 bits)</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>å°† Max Scractchpad Buffer æ‹¼æ¥èµ·æ¥å¯ä»¥å¾—åˆ°è½¯ä»¶éœ€è¦ç”³è¯·çš„ç”¨äºæš‚å­˜å™¨ç¼“å†²åŒºçš„å†…å®¹å¤§å°ï¼Œå¦‚æœè¯¥å€¼ä¸º <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math> ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç”³è¯·å†…å®¹ï¼Œæ›´å¤šè¦æ±‚åˆ™å’Œæ¥ä¸‹æ¥æåˆ°çš„pageSizeçš„å€¼æœ‰å…³ï¼Œä½†æ˜¯åœ¨æœ¬äººçš„æœºå­ä¸Šï¼Œè¿™ä¸ªå€¼éƒ½æ˜¯ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>ã€‚</p>
<h4 id="hcsparams-3-ç»“æ„åŒ–çš„å‚æ•°ç»„-3">hcsParams 3, ç»“æ„åŒ–çš„å‚æ•°ç»„ #3</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Bit</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0:7</td>
<td style="text-align: center;">U1 Device Exit Latency</td>
<td style="text-align: left;">ç”µæºçŠ¶æ€ä» U1 åˆ° U0 æ‰€éœ€è¦çš„å¾®ç§’æ•° (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mrow><mo>âˆ’</mo><mn>6</mn></mrow></msup><mi>s</mi><mo>=</mo><mn>1</mn><mi>Î¼</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">10^{-6}s=1\mu s</annotation></semantics></math>)</td>
</tr>
<tr class="even">
<td style="text-align: center;">8:15</td>
<td style="text-align: center;">Reserved</td>
<td style="text-align: left;">ä¿ç•™</td>
</tr>
<tr class="odd">
<td style="text-align: center;">16:31</td>
<td style="text-align: center;">U2 Device Exit Latency</td>
<td style="text-align: left;">ç”µæºçŠ¶æ€ä» U1 åˆ° U0 æ‰€éœ€è¦çš„å¾®ç§’æ•°</td>
</tr>
</tbody>
</table>
<h4 id="hccparams-1-ä½¿èƒ½å‚æ•°ç»„-1">hccParams 1, ä½¿èƒ½å‚æ•°ç»„ #1</h4>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Bit</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">64-bit Addressing Capability(AC64)</td>
<td style="text-align: left;">è¯¥XHCIæ§åˆ¶å™¨æ˜¯(1)å¦(0)å¯ä»¥ä½¿ç”¨64-bitåœ°å€ï¼Œå¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä½¿ç”¨çš„æ‰€æœ‰åœ°å€ï¼Œéƒ½ä¼šå¿½ç•¥é«˜32ä½ã€‚</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">BW Negotiation Capability(BNC)</td>
<td style="text-align: left;">ç”¨äºæŒ‡ç¤ºè¯¥æ§åˆ¶å™¨æ˜¯(1)å¦(0)å®ç°äº† Bandwidth Negotiation</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">Context Size(CSZ)</td>
<td style="text-align: left;">æŒ‡ç¤ºä¸Šä¸‹æ–‡çš„å¤§å° 1: 64-byte; 0: 32-byte ã€‚è¯¥ä½å¯¹ Stream Contexts ä¸ç”Ÿæ•ˆã€‚</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: center;">Port Power Control(PPC)</td>
<td style="text-align: left;">1: æ‰€æœ‰çš„ç«¯å£æ°¸è¿œå¤„äºé€šç”µçŠ¶æ€ï¼›0: æ¯ä¸ªç«¯å£å¯ä»¥è‡ªè¡Œæ§åˆ¶ä¾›ç”µçŠ¶æ€</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4</td>
<td style="text-align: center;">Port Indicators(PIND)</td>
<td style="text-align: left;">ç”¨äºæŒ‡ç¤ºç«¯å£æŒ‡ç¤ºç¯çš„æ§åˆ¶ã€‚0: æ§åˆ¶ä¸å¯ç”¨; 1: å‚ç…§ç«¯å£å¯„å­˜å™¨çš„ Bit 14:15 æ¥è·å–æ›´å¤šä¿¡æ¯</td>
</tr>
<tr class="even">
<td style="text-align: center;">5</td>
<td style="text-align: center;">Light HC Reset Capability(LHRC)</td>
<td style="text-align: left;">æŒ‡ç¤ºæ“ä½œå¯„å­˜å™¨ç»„ä¸­çš„ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">usbCmd</mtext><annotation encoding="application/x-tex">\text{usbCmd}</annotation></semantics></math> å¯„å­˜å™¨çš„ Light Host Controller åŠŸèƒ½æ˜¯(1)å¦(0)å¯ç”¨</td>
</tr>
<tr class="odd">
<td style="text-align: center;">6</td>
<td style="text-align: center;">Latency Tolerance Messaging Capability(LTC)</td>
<td style="text-align: left;">è¡¨ç¤ºè¯¥æ§åˆ¶å™¨æ˜¯(1)å¦(0)æ”¯æŒä¼ é€’å»¶è¿Ÿå®¹å¿æ¶ˆæ¯(Latency Tolerance Messageing, LTM)</td>
</tr>
<tr class="even">
<td style="text-align: center;">7</td>
<td style="text-align: center;">No Secondary SID Support(NSS)</td>
<td style="text-align: left;"><strong>æ˜¯(0)å¦(1)</strong> æ”¯æŒ Secondary Stream IDs.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8</td>
<td style="text-align: center;">Parse All Event Data(PAE)</td>
<td style="text-align: left;">1: å½“è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªä¼ è¾“æè¿°ç¬¦çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ TRB éƒ½ä¼šè¢«è§£æï¼›0: ä¸ä¼šã€‚æ£€æµ‹åˆ°ä¸€ä¸ª Short Packet çš„æ—¶å€™ä¼šä½¿ç”¨è¿™ä¸ªä½</td>
</tr>
<tr class="even">
<td style="text-align: center;">9</td>
<td style="text-align: center;">Stopped - Short Packet Capability(SPC)</td>
<td style="text-align: left;">è¯¥æ§åˆ¶å™¨æ˜¯(1)å¦(0)å¯ä»¥å‘å‡ºçŸ­æ•°æ®åŒ…åœæ­¢ä»£ç (Stopped-Short Packet Completion code)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10</td>
<td style="text-align: center;">Stopped EDTLA Capability(SEC)</td>
<td style="text-align: left;">è¯¥æ§åˆ¶å™¨æ˜¯(1)å¦(0)åœ¨ Stream Context ä¸­å®ç°äº† Stopped EDTLA åŒºåŸŸï¼Œå¯¹äºè¾ƒæ–°çš„ç¡¬ä»¶ï¼Œè¿™ä¸€ä½éƒ½æ˜¯ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>ã€‚</td>
</tr>
<tr class="even">
<td style="text-align: center;">11</td>
<td style="text-align: center;">Continuous Frame ID Capability(CFC)</td>
<td style="text-align: left;">è¯¥æ§åˆ¶å™¨æ˜¯(1)å¦(0)èƒ½å¤ŸåŒ¹é…è¿ç»­ ISO ä¼ è¾“æè¿°ç¬¦çš„ IDã€‚</td>
</tr>
<tr class="odd">
<td style="text-align: center;">12:15</td>
<td style="text-align: center;">Maximum Primary Stream Array Size(MaxPSASize)</td>
<td style="text-align: left;">å…è®¸çš„æœ€å¤§ Stream Array å¤§å°</td>
</tr>
<tr class="even">
<td style="text-align: center;">16:31</td>
<td style="text-align: center;">XHCI Extended Capabilities Pointer(xECP)</td>
<td style="text-align: left;">0: è¯¥æ§åˆ¶å™¨ä¸å­˜åœ¨æ‹“å±•ä½¿èƒ½æè¿°; <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&gt;0</annotation></semantics></math>: æ‹“å±•ä½¿èƒ½æè¿°çš„åç§»ï¼ˆç›¸å¯¹äº <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">baseAddr</mtext><annotation encoding="application/x-tex">\text{baseAddr}</annotation></semantics></math> ï¼‰</td>
</tr>
</tbody>
</table>
<p>å®é™…ä¸Šçš„ Stream Array æœ€å¤§å¤§å°éœ€è¦ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è®¡ç®— :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">maxSize</mtext><mo>=</mo><msup><mn>2</mn><mrow><mtext mathvariant="normal">MaxPSASize</mtext><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">
\text{maxSize}=2^{\text{MaxPSASize}+1}
</annotation></semantics></math></p>
<p>å¯¹äºæ‹“å±•æ—¶èƒ½æè¿°çš„åç§»å®é™…ä¸Šæ˜¯ï¼š</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">offset of extended Capabilites</mtext><mo>=</mo><mtext mathvariant="normal">baseAddr</mtext><mo>+</mo><mn>4</mn><mo>Ã—</mo><mtext mathvariant="normal">xECP</mtext></mrow><annotation encoding="application/x-tex">
\text{offset of extended Capabilites}=\text{baseAddr} + 4\times \text{xECP}
</annotation></semantics></math></p>
<h4 id="hccparams-2-ä½¿èƒ½å‚æ•°ç»„-2">hccParams 2, ä½¿èƒ½å‚æ•°ç»„ #2</h4>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Bit</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">U3 Entry Capability</td>
<td style="text-align: left;">æ ¹(root hub)æ˜¯å¦æ”¯æŒæš‚åœå®Œæˆé€šçŸ¥(Suspend Completion notification)</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">ConfigEP Command Max Exit Latency too Large(CMC)</td>
<td style="text-align: left;">æ˜¯(1)å¦(0)å¯ä»¥ç”Ÿæˆæœ€å¤§é€€å‡ºæ½œä¼æœŸè¿‡é•¿çš„å…¼å®¹é”™è¯¯(Exit Latency too Large compatibility error)ï¼Œè¯¥ä½è¢«æ“ä½œå¯„å­˜å™¨çš„ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">usbCmd</mtext><annotation encoding="application/x-tex">\text{usbCmd}</annotation></semantics></math> çš„ CME ä½ä½¿ç”¨ã€‚</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">Force Save Context Capability(FSC)</td>
<td style="text-align: left;">Save Stateå‘½ä»¤æ˜¯(1)å¦(0)åº”å½“å°†æ‰€æœ‰çš„cached Slot, End Point, Streamå’Œå…¶ä»–ä¸Šä¸‹æ–‡å­˜å‚¨åˆ°å†…å­˜ä¸­</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: center;">Compliance Transition Capability(CTC)</td>
<td style="text-align: left;">è¯¥æ§åˆ¶å™¨æ˜¯(1)å¦(0) æ”¯æŒ Compliance Transition Enabled ä½</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4</td>
<td style="text-align: center;">Large ESIT Payload Capability(LEC)</td>
<td style="text-align: left;">æ˜¯(1)å¦(0)æ”¯æŒå¤§äº <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>48</mn><mtext mathvariant="monospace">ğ™ºğš‹</mtext></mrow><annotation encoding="application/x-tex">48\texttt{Kb}</annotation></semantics></math> çš„ ESIT Payloads</td>
</tr>
<tr class="even">
<td style="text-align: center;">5</td>
<td style="text-align: center;">Configuration Information Capability</td>
<td style="text-align: left;">æ˜¯(1)å¦(0)æ”¯æŒ è¾“å…¥æ§åˆ¶ä¸Šä¸‹æ–‡å—(Input Control Context block) ä¸­çš„ Configuration Value, Interface Number å’Œ Alternate settings åŸŸçš„æ‹“å±•é…ç½®ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h3 id="extended-capabilites-list">Extended Capabilites List</h3>
<p>é™¤äº†ä¸Šé¢çš„ Capability Registersï¼ŒXHCI è¿˜æä¾›äº†é“¾è¡¨ç»“æ„çš„æ‹“å±•ä½¿èƒ½åˆ—è¡¨ï¼Œå’Œ PCIe éå¸¸ç±»ä¼¼ã€‚æ¯ä¸ªæ‹“å±•æè¿°ç¬¦éƒ½é•¿ä¸‹é¢è¿™æ ·ï¼š</p>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Bit</th>
<th style="text-align: center;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0:7</td>
<td style="text-align: center;">ID</td>
<td style="text-align: left;">RO, è¯¥æ‹“å±•æè¿°ç¬¦çš„ ID</td>
</tr>
<tr class="even">
<td style="text-align: center;">8:15</td>
<td style="text-align: center;">Next</td>
<td style="text-align: left;">RO, ä¸‹ä¸€ä¸ªæ‹“å±•æè¿°ç¬¦ç›¸å¯¹äºå½“å‰æè¿°ç¬¦çš„åç§»ï¼Œè®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">next offset</mtext><mo>=</mo><mtext mathvariant="normal">current offset</mtext><mo>+</mo><mn>4</mn><mo>Ã—</mo><mtext mathvariant="normal">Next</mtext></mrow><annotation encoding="application/x-tex">\text{next offset}=\text{current offset} + 4\times \text{Next}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;">n</td>
<td style="text-align: center;">Varies</td>
<td style="text-align: left;">æ¯ä¸ª <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">ID</mtext><annotation encoding="application/x-tex">\text{ID}</annotation></semantics></math> ç‰¹å®šçš„å†…å®¹</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢ç»™å‡ºä¸€äº›å¸¸ç”¨çš„ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">ID</mtext><annotation encoding="application/x-tex">\text{ID}</annotation></semantics></math> å¯¹ç…§è¡¨ï¼š</p>
</body>
</html>
