<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>XHCI</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
</head>
<body>
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>æœ¬æ–‡å‚è€ƒäº† <a href="https://wiki.osdev.org/XHCI">XHCI on OS Dev</a> ä»¥åŠ ã€ŠUSB: The Universal Series Busã€‹ã€‚ä»£ç å­˜å‚¨äº <code>github.com/juruohejiarui/VCPP-2.git</code> ä¸­çš„ <code>VOS/kernel/hardware/USB</code> .</p>
<p>éœ€è¦å…ˆç®€å•äº†è§£ PCIe çš„æ•°æ®ç»“æ„å’Œæšä¸¾ã€æ£€æµ‹ UEFI æä¾›çš„ PCIe ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<h1 id="æ•°æ®ç»“æ„å’Œæ³¨é‡Š">æ•°æ®ç»“æ„å’Œæ³¨é‡Š</h1>
<h2 id="pcie">PCIe</h2>
<p>ä» UEFI æä¾›çš„ <code>MCFG</code> è¡¨ä¸­ï¼Œå¯ä»¥è¯»å‡ºä¸€ä¸ª PCIe æ•°æ®è¡¨çš„ç»“æ„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>PCIeConfig</code>ï¼Œå¯¹äº XHCI è®¾å¤‡ï¼Œå…¶ç»“æ„ä¸€èˆ¬å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Offset</th>
<th style="text-align: center;">Size(Byte)</th>
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0x0</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">Vendor ID</td>
<td style="text-align: center;">åˆ¶é€ å•† ID</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">Device ID</td>
<td style="text-align: center;">åˆ¶é€ å•†ç”³è¯·çš„è®¾å¤‡ç‰¹å®šçš„ ID</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x4</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">Command</td>
<td style="text-align: center;">ç”¨äºæ“ä½œè¯¥PCIeè®¾å¤‡çš„å¯„å­˜å™¨</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x6</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">Status</td>
<td style="text-align: center;">è¯¥è®¾å¤‡çš„çŠ¶æ€</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0x8</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">Revision ID</td>
<td style="text-align: center;">æˆ‘ä¹Ÿä¸æ‡‚ï¼Œåº”è¯¥ä¸å¤ªé‡è¦ï¼Œå¯ä»¥å¿½ç•¥</td>
</tr>
<tr class="even">
<td style="text-align: center;">0x9</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">Prog IF</td>
<td style="text-align: center;">Program Interface Byte, åªè¯»ï¼Œç”¨äºå¯„å­˜å™¨çº§åˆ«ä¸‹æŒ‡å®šè¯¥è®¾å¤‡çš„ç±»åˆ«</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0xa</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">Subclass</td>
<td style="text-align: center;">å­ç±» ID</td>
</tr>
<tr class="even">
<td style="text-align: center;">0xb</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">Class Id</td>
<td style="text-align: center;">ç±» ID</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0xc</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">Cache Line Size</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">Class Id, subClass, Prog IF</mtext><annotation encoding="application/x-tex">\text{Class Id, subClass, Prog IF}</annotation></semantics></math> ä¸‰è€…å…±åŒç¡®è®¤ä¸€ä¸ªè®¾å¤‡çš„ç±»åˆ«ï¼Œç½‘ä¸Šæœ‰å¯¹ç…§è¡¨ï¼Œè¿™é‡Œå°±ä¸ç²˜å‡ºæ¥äº†ã€‚å¯¹äº XHCI è®¾å¤‡ï¼Œ<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Class Id</mtext><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğ™²</mtext><mo>,</mo><mtext mathvariant="normal">Subclass</mtext><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¹</mtext><mo>,</mo><mtext mathvariant="normal">Prog IF</mtext><mo>=</mo><mtext mathvariant="monospace">ğŸ¶ğš¡ğŸ¹ğŸ¶</mtext></mrow><annotation encoding="application/x-tex">\text{Class Id}=\texttt{0xC}, \text{Subclass}=\texttt{0x3}, \text{Prog IF}=\texttt{0x30}</annotation></semantics></math></p>
</body>
</html>
